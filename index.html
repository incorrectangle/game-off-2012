<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <title>.:Moonening:.</title>
        <style type="text/css" media="screen">
            body {
                    background-color: #AAAAAA;
        			margin:0px;
        			font-family: Verdana,Geneva,Arial,sans-serif;
        			font-size: 12px;
        			line-height: 15px;
                    text-align:center;
        		}
            canvas {
                background-color:transparent;
                border: #000000 1px solid;
            }
        </style>
        <script src="submodules/bang/mod.js" type="text/javascript" charset="utf-8"></script>
        <link rel="shortcut icon" href="favicon.png" />
    </head>
    <body id="body">
        
        <div id="bang"></div>
        <script type="text/javascript" charset="utf-8">
            mod.useTagInjection = true;
            mod.expansions = {
                bang : 'submodules/bang/src/',
                moon : 'src/'
            };
            mod({
                name : "Main",
                dependencies : [
                    'moon::Editor/Level.js',
                    'bang::View/Stage.js',
                    'moon::View/MapView.js'
                ],
                init : function initMain (LevelEditor, Stage, MapView) {
                    var editor = new LevelEditor();
                    editor.init();
                    window.editor = editor;

                    var stage = window.stage = new Stage(512, 512);
                    document.body.appendChild(stage.canvas);

                    var mapView = window.mapView = new MapView(0,0,512,512);
                    mapView.tilesX = 32;
                    mapView.tilesY = 32;
                    stage.addView(mapView);  
                    var img = new Image();
                    img.addEventListener('load', function() {
                        var floor = new View(0,0,32,32);
                        floor.context.drawImage(img,0,0,32,32,0,0,32,32);
                        mapView.addTile(floor);
                    });
                    img.src = 'img/tiles.png';
                    
                    mod.exportAll();
                    //setTimeout(function() {
                    //    outline.context.putImageData(Filters.mapBitmap(toon.context.getImageData(0,0,30,50), function thresh(pixel,imageData) {
                    //        var width = 2;
                    //        if (pixel.a === 0) {
                    //            var count = Filters.getMoore(pixel, 2).reduce(function(acc, neighborPixel) {
                    //                if (neighborPixel.a > 0) {
                    //                    return acc+1;
                    //                }
                    //                return acc;
                    //            }, 0);
                    //            pixel.r = 0;
                    //            pixel.g = 0;
                    //            pixel.b = 0;
                    //            pixel.a = count > 1 ? 255 : 0; 
                    //        } else {
                    //            pixel.r = 0;
                    //            pixel.g = 0;
                    //            pixel.b = 0;
                    //            pixel.a = 0;
                    //        }
                    //        return pixel;
                    //    }), 0, 0);
                    //}, 1000);
                }
            });
        </script>
    </body>
</html>
